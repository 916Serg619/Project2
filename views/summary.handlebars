<body>
  <main>

    <nav class="navbar navbar-expand-sm color">
      <div class="container-fluid">
        <div class="navbar-header row">
          <a class="navbar-brand navbtn1 col" href="/members"><i class="fab fa-pagelines fa-1x"></i>
          <br>
            Main
          </a>
          <a class="navbar-brand navbtn1 col" href="/logout"><i class="fab fa-envira"></i>
          <br>
            Logout
          </a>
        </div>
      </div>
    </nav>
<h3 id="eventInfoId">{{event.id}}</h3>
    {{!-- Event Info Table --}}
    <div class="card color">
      <div class="card-header">
        <h3>Event Info</h3>
      </div>
      <div style="overflow-x:auto;">
        <table class="table table-striped">
            {{!-- Head --}}
            <thead>
              <tr>
                <th>Couple</th>
                <th>Venue</th>
                <th>Event Date</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            {{!-- Body --}}
            <tr class="eventInfoEdit">
              <td class="event-data"><textarea readonly>{{event.couple}}</textarea></td>
              <td class="event-data"><textarea readonly>{{event.venueName}}</textarea></td>
              <td class="event-data"><textarea readonly>{{event.eventDate}}</textarea></td>
              <td class="event-data"><textarea readonly>{{event.foodOptionOne}}</textarea></td>
              <td class="event-data"><textarea readonly>{{event.foodOptionTwo}}</textarea></td>
              <td><button type="button" class="btn navbtn1 editEvent"><i class="far fa-edit fa-1x"></i>
                  Edit</button>
                <button type="button" class="btn navbtn1 editEventSave"><i class="far fa-save fa-1x"></i>
                  Save</button>
                  <button type="button" class="btn navbtn1 delete-event" data-Id="{{event.id}}"
                  onclick="deleteEvent({{event.id}})" href="/members"><i class="far fa-trash-alt fa-1x"></i>
                  Delete</button>
                  </td>
            </tr>
          </table>
        </div>
      </div>
    </div>

   
    {{!-- Vendor Info Card--}}
    <section id="vendor-section" id="vendorInfo">
      <div class="card-body">
        <div class = "row">
        <h3 class="card-title col-11">Vendor Info</h3>
        <button type="button" class="btn navbtn1 col col-1" onclick="window.location = '/vendorInfos/{{event.id}}';"><i class="fas fa-user-plus"></i> Add</button>
          </div>
        <div style="overflow-x:auto;"></div>
        <div style="overflow-x:auto;">
          <table class="table table-striped">
            <table class="table table-striped">
              {{!-- Head --}}
              <thead>
                <tr>
                  <th>Vendor Name</th>
                  <th>Service</th>
                  <th>Email</th>
                  <th>Phone</th>
                </tr>
              </thead>
              {{!-- Row populate --}}
              {{#each vendor}}
              <tr>
                <td id="vendor-data{{dataValues.id}}"><textarea readonly>{{dataValues.vendorName}}</textarea></td>
                <td id="vendor-data{{dataValues.id}}"><textarea readonly>{{dataValues.service}}</textarea></td>
                <td id="vendor-data{{dataValues.id}}"><textarea readonly>{{dataValues.email}}</textarea></td>
                <td id="vendor-data{{dataValues.id}}"><textarea readonly>{{dataValues.phone}}</textarea></td>
                <td><button type="button" class="btn navbtn1 editVendor" id="{{dataValues.id}}"><i
                      class="far fa-edit fa-1x"></i> Edit</button>
                  <button type="button" class="btn navbtn1 editVendorSave" id="{{dataValues.id}}"><i
                      class="far fa-save fa-1x"></i> Save</button>
                      <button type="button" class="btn navbtn1 delete-vendor" data-Id="{{dataValues.id}}"
                    onclick="deleteVendor({{dataValues.id}})"><i class="far fa-trash-alt fa-1x"></i> Delete</button>
                <td>
              </tr>
              {{/each}}
            </table>
        </div>
      </div>
      </div>
    </div>
    </div>

    {{!-- Scripts --}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="js/summary.js"></script>
    <script type="text/javascript">
      // EDIT EVENT
      // When edit button toggle textarea readonly
      $('td').on('click', '.editEvent', function (event) {
        event.preventDefault();
        // Target all text areas and toggle readonly
        $("td.event-data").children("textarea").each(function () {
          var re = $(this).prop('readonly');
          $(this).prop('readonly', !re);
        });
      });

      // SAVE EVENT
      // Save button 
      $('td').on('click', '.editEventSave', function (event) {
        event.preventDefault();

        // This holds our event data
        var data = {};
        var counter = 0
        // Target all text areas and put data into array
        $("td.event-data").children("textarea").each(function () {
          // We create key value pairs for the data obj
          var key = "key" + counter;
          data[key] = $(this).val();
          counter++;
        });
        // Grab the id from the url
        var id = (window.location.href).slice(-1)
        $.ajax("/api/eventInfos/" + id, {
          type: "PUT",
          data: data
        }).then(function () {
          console.log("event edited");
        })
      });

      // DELETE VENDOR
      function deleteVendor(id) {
        console.log("this was deleted");
        console.log(id);
        $.ajax({
          method: "DELETE",
          url: "/api/vendorInfos/" + id
        }
        )
        location.reload();
      }

      // DELETE EVENT
      function deleteEvent(id) {
        console.log("this event was deleted");
        console.log(id);
        $.ajax({
          method: "DELETE",
          url: "/api/eventInfos/" + id
        }
        )
        window.location.href = "/members";
      }

      // EDIT VENDOR
      // When edit button toggle textarea readonly
      $('td').on('click', '.editVendor', function (event) {
        event.preventDefault();

        // Id of the row
        var idNum = $(this).attr("id");

        // Target all text areas and toggle readonly
        $(`*[id*=vendor-data${idNum}]`).children("textarea").each(function () {
          var re = $(this).prop('readonly');
          $(this).prop('readonly', !re);
        });
      });

      // SAVE Vendor
      // Save button 
      $('td').on('click', '.editVendorSave', function (event) {
        event.preventDefault();

        // Id of the row
        var idNum = $(this).attr("id");
        // This holds our event data
        var data = {};
        var counter = 0
        // Target all text areas and put data into array
        $(`*[id*=vendor-data${idNum}]`).children("textarea").each(function () {
          // We create key value pairs for the data obj
          var key = "key" + counter;
          data[key] = $(this).val();
          counter++;
        });
        $.ajax("/api/vendorInfos/" + idNum, {
          type: "PUT",
          data: data
        }).then(function () {
          console.log("vendor edited");
        })
      });
    </script>
</body>
</main>